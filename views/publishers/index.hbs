<h1>Éditeurs</h1>

<p>
  <a href="/publishers/new">Créer un nouvel éditeur</a>
</p>

{{#if publishers.length}}
  <ul>
    {{#each publishers}}
      <li>
        <a href="/publishers/{{id}}">{{name}}</a>
        — <a href="/publishers/{{id}}/edit">Modifier</a>
        <form
          action="/publishers/{{id}}/delete"
          method="POST"
          style="display:inline; margin-left:8px;"
          data-confirm="delete-publisher"
          data-publisher-name="{{name}}"
          data-publisher-games="{{#if games.length}}{{#each games}}{{title}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(aucun jeu){{/if}}">
          <button type="submit">Supprimer</button>
        </form>
      </li>
    {{/each}}
  </ul>
{{else}}
  <p>Aucun éditeur pour le moment.</p>
{{/if}}

<script>
  (function () {
    const forms = document.querySelectorAll('form[data-confirm="delete-publisher"]');
    forms.forEach((form) => {
      form.addEventListener("submit", function (e) {
        const name = form.getAttribute("data-publisher-name") || "cet éditeur";
        const games = form.getAttribute("data-publisher-games") || "(aucun jeu)";
        const list = games
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean)
          .map((title) => `- ${title}`)
          .join("\n");
        const message =
          `ATTENTION : Supprimer "${name}" supprimera aussi tous ces jeux :\n\n` +
          (list || "- (aucun jeu)") +
          "\n\nContinuer ?";
        if (!confirm(message)) {
          e.preventDefault();
        }
      });
    });
  })();
</script>
